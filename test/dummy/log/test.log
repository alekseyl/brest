  [1m[35m (0.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "brest_test"[0m
  [1m[35m (312.9ms)[0m  [1m[35mCREATE DATABASE "brest_test" ENCODING = 'unicode'[0m
  [1m[35m (7.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_try_advisory_lock(4359920649563150700)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2024-02-10 14:51:09.407203', '2024-02-10 14:51:09.407217') RETURNING "key"[0m
Migrating to CreateItems (20211021033143)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.2ms)[0m  [1m[35mCREATE TABLE "items" ("id" bigserial primary key, "code" smallint, "name" character varying, "price" float, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20211021033143') RETURNING "version"[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePromotions (20211021142811)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.0ms)[0m  [1m[35mCREATE TABLE "promotions" ("id" bigserial primary key, "title" character varying, "active" boolean DEFAULT TRUE, "discount" integer, "open" boolean DEFAULT FALSE, "pattern" character varying[] DEFAULT '{}', "free_stuff" character varying[] DEFAULT '{}', "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE INDEX "index_promotions_on_pattern" ON "promotions" USING gin ("pattern") WHERE "active"[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20211021142811') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(4359920649563150700)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (113.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "brest_test"[0m
  [1m[35m (309.1ms)[0m  [1m[35mCREATE DATABASE "brest_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.9ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql"[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "items" CASCADE[0m
  [1m[35m (9.1ms)[0m  [1m[35mCREATE TABLE "items" ("id" bigserial primary key, "code" smallint, "name" character varying, "price" float, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "promotions" CASCADE[0m
  [1m[35m (5.3ms)[0m  [1m[35mCREATE TABLE "promotions" ("id" bigserial primary key, "title" character varying, "active" boolean DEFAULT TRUE, "discount" integer, "open" boolean DEFAULT FALSE, "pattern" character varying[] DEFAULT '{}', "free_stuff" character varying[] DEFAULT '{}', "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE INDEX "index_promotions_on_pattern" ON "promotions" USING gin ("pattern") WHERE "active"[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20211021142811)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20211021033143);[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2024-02-10 14:51:43.415563', '2024-02-10 14:51:43.415575') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.9ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '000911cadbecd86b2e1a15ad293c159f8e4af24e', '2024-02-10 14:51:43.421579', '2024-02-10 14:51:43.421585') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.4ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 14:54:46.818286', '2024-02-10 14:54:46.818286'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 14:54:46.818286', '2024-02-10 14:54:46.818286'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 14:54:46.818286', '2024-02-10 14:54:46.818286');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 14:54:46.820859', '2024-02-10 14:54:46.820859'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 14:54:46.820859', '2024-02-10 14:54:46.820859'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 14:54:46.820859', '2024-02-10 14:54:46.820859')[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.4ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 15:11:55.767522', '2024-02-10 15:11:55.767522'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 15:11:55.767522', '2024-02-10 15:11:55.767522'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 15:11:55.767522', '2024-02-10 15:11:55.767522');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 15:11:55.770641', '2024-02-10 15:11:55.770641'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 15:11:55.770641', '2024-02-10 15:11:55.770641'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 15:11:55.770641', '2024-02-10 15:11:55.770641')[0m
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 15:13:59.767133', '2024-02-10 15:13:59.767133'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 15:13:59.767133', '2024-02-10 15:13:59.767133'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 15:13:59.767133', '2024-02-10 15:13:59.767133');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 15:13:59.769437', '2024-02-10 15:13:59.769437'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 15:13:59.769437', '2024-02-10 15:13:59.769437'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 15:13:59.769437', '2024-02-10 15:13:59.769437')[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 17:52:49.893371', '2024-02-10 17:52:49.893371'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 17:52:49.893371', '2024-02-10 17:52:49.893371'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 17:52:49.893371', '2024-02-10 17:52:49.893371');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 17:52:49.896006', '2024-02-10 17:52:49.896006'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 17:52:49.896006', '2024-02-10 17:52:49.896006'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 17:52:49.896006', '2024-02-10 17:52:49.896006')[0m
  [1m[36mTRANSACTION (1.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.5ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 18:11:59.503086', '2024-02-10 18:11:59.503086'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 18:11:59.503086', '2024-02-10 18:11:59.503086'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 18:11:59.503086', '2024-02-10 18:11:59.503086');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 18:11:59.506032', '2024-02-10 18:11:59.506032'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 18:11:59.506032', '2024-02-10 18:11:59.506032'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 18:11:59.506032', '2024-02-10 18:11:59.506032')[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
PromotionApiTest - test_UPDATE_promotion_OK: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_changes`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
PromotionApiTest - test_CREATE_promotion_OK: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
PromotionApiTest - test_DESTROY_goes_OK: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.7ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
ItemsApiTest - test_UPDATE_item_OK: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_no_changes`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
ItemsApiTest - test_DESTROY_goes_OK: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
ItemsApiTest - test_CREATE_item_OK: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
ItemsApiTest: test_No_discount_whenever_conditions_are_not_matched
------------------------------------------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------------
ItemsApiTest: test_Check_two_mugs_total
---------------------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_Tshirts_30%_for_3+
-------------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.9ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 18:13:54.771037', '2024-02-10 18:13:54.771037'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 18:13:54.771037', '2024-02-10 18:13:54.771037'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 18:13:54.771037', '2024-02-10 18:13:54.771037');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 18:13:54.773642', '2024-02-10 18:13:54.773642'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 18:13:54.773642', '2024-02-10 18:13:54.773642'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 18:13:54.773642', '2024-02-10 18:13:54.773642')[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
PromotionApiTest - test_CREATE_promotion_OK: ArgumentError raised.
If you expected this exception, use `assert_raises` as near to the code that raises as possible.
Other block based assertions (e.g. `assert_difference`) can be used, as long as `assert_raises` is inside their block.

  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:13:54 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 961)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:13:54 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 482)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:13:54 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.7ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 4ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 246)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:13:54 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.7ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 229)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:13:54 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 229)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:13:54 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (1.6ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.9ms | Allocations: 631)
  [1m[36mPromotion Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 463)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 417)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 310)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 4ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 467)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 224)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 223)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.7ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 6ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 4135)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (2.0ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 3.3ms | Allocations: 468)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.5ms | Allocations: 327)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 296)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 241)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 16ms (Views: 0.7ms | ActiveRecord: 0.5ms | Allocations: 455)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
ItemsApiTest: test_No_discount_whenever_conditions_are_not_matched
------------------------------------------------------------------
Started POST "//cart/items_total.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------------
ItemsApiTest: test_Check_two_mugs_total
---------------------------------------
Started POST "//cart/items_total.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_Tshirts_30%_for_3+
-------------------------------------
Started POST "//cart/items_total.json" for 127.0.0.1 at 2024-02-10 18:13:55 +0000
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 18:15:42.898979', '2024-02-10 18:15:42.898979'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 18:15:42.898979', '2024-02-10 18:15:42.898979'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 18:15:42.898979', '2024-02-10 18:15:42.898979');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 18:15:42.901372', '2024-02-10 18:15:42.901372'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 18:15:42.901372', '2024-02-10 18:15:42.901372'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 18:15:42.901372', '2024-02-10 18:15:42.901372')[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:15:42 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 1ms (Views: 0.3ms | ActiveRecord: 0.0ms | Allocations: 649)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 6196)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 297)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.8ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 2.9ms | Allocations: 1029)
  [1m[36mItem Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 447)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 455)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 0ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 310)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 241)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 240)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 223)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 223)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
Completed 422 Unprocessable Entity in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 417)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 6402)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 330)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (1.8ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 3.0ms | Allocations: 681)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 452)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 463)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
Completed 422 Unprocessable Entity in 10ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 310)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 281)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 231)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 229)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:15:43 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 229)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.9ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 18:17:56.041583', '2024-02-10 18:17:56.041583'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 18:17:56.041583', '2024-02-10 18:17:56.041583'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 18:17:56.041583', '2024-02-10 18:17:56.041583');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 18:17:56.043761', '2024-02-10 18:17:56.043761'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 18:17:56.043761', '2024-02-10 18:17:56.043761'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 18:17:56.043761', '2024-02-10 18:17:56.043761')[0m
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.7ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-10 18:17:56.121395"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.3ms | ActiveRecord: 4.1ms | Allocations: 2687)
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 2.6ms | Allocations: 1630)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (2.4ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-10 18:17:56.188857"], ["updated_at", "2024-02-10 18:17:56.188857"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 3.4ms | Allocations: 874)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 281)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.0ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 6ms (Views: 0.2ms | ActiveRecord: 2.8ms | Allocations: 1319)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (1.7ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.8ms | Allocations: 497)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 322)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 342)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 246)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 229)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 229)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f8f4c3b1680>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (1.7ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-10 18:17:56.367407"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 2.5ms | Allocations: 1213)
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 737)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (1.8ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-10 18:17:56.404796"], ["updated_at", "2024-02-10 18:17:56.404796"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 2.5ms | Allocations: 653)
  [1m[36mItem Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 241)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 1148)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.7ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 3.0ms | Allocations: 426)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 281)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 283)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 225)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 223)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:17:56 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 223)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.4ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 18:19:00.866408', '2024-02-10 18:19:00.866408'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 18:19:00.866408', '2024-02-10 18:19:00.866408'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 18:19:00.866408', '2024-02-10 18:19:00.866408');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 18:19:00.868736', '2024-02-10 18:19:00.868736'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 18:19:00.868736', '2024-02-10 18:19:00.868736'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 18:19:00.868736', '2024-02-10 18:19:00.868736')[0m
  [1m[36mTRANSACTION (2.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:19:00 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 986)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:19:00 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.9ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 3.8ms | Allocations: 2051)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (1.1ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 4ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 248)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 229)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 229)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 322)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 342)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.9ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 8ms (Views: 0.2ms | ActiveRecord: 3.2ms | Allocations: 1352)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (1.8ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.9ms | Allocations: 571)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (2.0ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-10 18:19:01.144538"], ["updated_at", "2024-02-10 18:19:01.144538"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 2.8ms | Allocations: 1016)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.2ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.7ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-10 18:19:01.177582"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 4.2ms | Allocations: 1291)
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 559)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 1281)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 226)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.7ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 223)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.7ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.7ms | Allocations: 223)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 281)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 283)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 724)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.7ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.8ms | Allocations: 452)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (1.9ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-10 18:19:01.346749"], ["updated_at", "2024-02-10 18:19:01.346749"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 2.6ms | Allocations: 661)
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:19:01 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007fbe3a64fbe0>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (2.0ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-10 18:19:01.375066"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.4ms | ActiveRecord: 3.3ms | Allocations: 766)
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.8ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 18:23:53.052319', '2024-02-10 18:23:53.052319'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 18:23:53.052319', '2024-02-10 18:23:53.052319'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 18:23:53.052319', '2024-02-10 18:23:53.052319');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 18:23:53.055620', '2024-02-10 18:23:53.055620'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 18:23:53.055620', '2024-02-10 18:23:53.055620'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 18:23:53.055620', '2024-02-10 18:23:53.055620')[0m
  [1m[36mTRANSACTION (4.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.7ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 12ms (Views: 0.3ms | ActiveRecord: 1.1ms | Allocations: 8029)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 242)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 223)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 223)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f206b2e00a8>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (2.1ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-10 18:23:53.217868"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 3.3ms | Allocations: 1229)
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 1195)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 287)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 296)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 241)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (2.3ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-10 18:23:53.304755"], ["updated_at", "2024-02-10 18:23:53.304755"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 3.0ms | Allocations: 699)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.7ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.7ms | Allocations: 486)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 18ms (Views: 0.2ms | ActiveRecord: 4.0ms | Allocations: 8049)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 232)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 229)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 229)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.9ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.6ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-10 18:23:53.425896"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 3.7ms | Allocations: 1267)
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 3.1ms | Allocations: 1330)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 317)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 329)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 281)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (1.7ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-10 18:23:53.524226"], ["updated_at", "2024-02-10 18:23:53.524226"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 2.5ms | Allocations: 780)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:23:53 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (1.8ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 3.0ms | Allocations: 437)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-10 18:24:35.279056', '2024-02-10 18:24:35.279056'), (754382202, 2, 'FOREVER', 15.0, '2024-02-10 18:24:35.279056', '2024-02-10 18:24:35.279056'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-10 18:24:35.279056', '2024-02-10 18:24:35.279056');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-10 18:24:35.281234', '2024-02-10 18:24:35.281234'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-10 18:24:35.281234', '2024-02-10 18:24:35.281234'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-10 18:24:35.281234', '2024-02-10 18:24:35.281234')[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (1.5ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-10 18:24:35.343266"], ["updated_at", "2024-02-10 18:24:35.343266"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.2ms | ActiveRecord: 2.0ms | Allocations: 7257)
  [1m[36mItem Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 1397)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 503)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 290)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 513)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.7ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.9ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 3.3ms | Allocations: 512)
  [1m[36mItem Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f7abdbd7ee8>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (1.5ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-10 18:24:35.478378"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.1ms | ActiveRecord: 2.2ms | Allocations: 862)
  [1m[36mItem Load (0.2ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 705)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 233)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 216)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 216)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (2.0ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-10 18:24:35.560112"], ["updated_at", "2024-02-10 18:24:35.560112"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.2ms | ActiveRecord: 2.8ms | Allocations: 7045)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.7ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 17ms (Views: 0.2ms | ActiveRecord: 2.6ms | Allocations: 1518)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 320)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 323)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 462)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (1.5ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.9ms | Allocations: 441)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.1ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.6ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-10 18:24:35.690522"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 4.0ms | Allocations: 1180)
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 2.9ms | Allocations: 1299)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 224)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 222)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-10 18:24:35 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 222)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.1ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-12 04:49:02.878291', '2024-02-12 04:49:02.878291'), (754382202, 2, 'FOREVER', 15.0, '2024-02-12 04:49:02.878291', '2024-02-12 04:49:02.878291'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-12 04:49:02.878291', '2024-02-12 04:49:02.878291');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-12 04:49:02.880825', '2024-02-12 04:49:02.880825'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-12 04:49:02.880825', '2024-02-12 04:49:02.880825'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-12 04:49:02.880825', '2024-02-12 04:49:02.880825')[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:49:02 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (1.7ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-12 04:49:02.942752"], ["updated_at", "2024-02-12 04:49:02.942752"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.3ms | ActiveRecord: 2.4ms | Allocations: 7257)
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:49:02 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.6ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 8ms (ActiveRecord: 3.4ms | Allocations: 1108)
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 971)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 1137)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 308)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 289)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f0f197c65f8>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (2.0ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-12 04:49:03.075712"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 3.3ms | Allocations: 855)
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 234)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 216)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 216)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 234)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (2.0ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-12 04:49:03.171333"], ["updated_at", "2024-02-12 04:49:03.171333"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 2.7ms | Allocations: 7045)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (2.1ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 8ms (ActiveRecord: 3.4ms | Allocations: 710)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.1ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 8ms (Views: 0.2ms | ActiveRecord: 3.4ms | Allocations: 1474)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 16ms (Views: 0.2ms | ActiveRecord: 3.3ms | Allocations: 1299)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 315)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.7ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 322)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.9ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.9ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-12 04:49:03.313493"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 4.2ms | Allocations: 1151)
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 225)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 222)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 222)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:49:03 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 274)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.7ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-12 04:52:46.385556', '2024-02-12 04:52:46.385556'), (754382202, 2, 'FOREVER', 15.0, '2024-02-12 04:52:46.385556', '2024-02-12 04:52:46.385556'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-12 04:52:46.385556', '2024-02-12 04:52:46.385556');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-12 04:52:46.387747', '2024-02-12 04:52:46.387747'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-12 04:52:46.387747', '2024-02-12 04:52:46.387747'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-12 04:52:46.387747', '2024-02-12 04:52:46.387747')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f4ba858e9e0>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (1.5ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-12 04:52:46.454972"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 2.5ms | Allocations: 2099)
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.8ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 0.8ms | Allocations: 236)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 283)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 289)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (2.8ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 4.0ms | Allocations: 484)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 958)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (1.9ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-12 04:52:46.602755"], ["updated_at", "2024-02-12 04:52:46.602755"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 2.7ms | Allocations: 731)
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 1136)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 233)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 216)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 216)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.9ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.5ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-12 04:52:46.696982"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 3.6ms | Allocations: 1766)
  [1m[36mPromotion Load (0.7ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 275)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 310)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 322)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (1.9ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 3.3ms | Allocations: 433)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 9ms (Views: 0.2ms | ActiveRecord: 4.0ms | Allocations: 1365)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (2.2ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-12 04:52:46.823429"], ["updated_at", "2024-02-12 04:52:46.823429"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 3.1ms | Allocations: 787)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 3.2ms | Allocations: 1297)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 224)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 222)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:52:46 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 222)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.7ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-12 04:55:55.749514', '2024-02-12 04:55:55.749514'), (754382202, 2, 'FOREVER', 15.0, '2024-02-12 04:55:55.749514', '2024-02-12 04:55:55.749514'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-12 04:55:55.749514', '2024-02-12 04:55:55.749514');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-12 04:55:55.752309', '2024-02-12 04:55:55.752309'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-12 04:55:55.752309', '2024-02-12 04:55:55.752309'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-12 04:55:55.752309', '2024-02-12 04:55:55.752309')[0m
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:55:55 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 896)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:55:55 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 1241)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:55:55 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f61a8776a58>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (1.8ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-12 04:55:55.878008"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.3ms | ActiveRecord: 2.9ms | Allocations: 1168)
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:55:55 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (2.0ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-12 04:55:55.901688"], ["updated_at", "2024-02-12 04:55:55.901688"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.2ms | ActiveRecord: 2.9ms | Allocations: 734)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:55:55 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 233)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:55:55 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 216)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:55:55 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 43ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 216)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 280)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 289)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 1136)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.7ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.9ms | Allocations: 479)
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 594)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.8ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 15ms (Views: 0.5ms | ActiveRecord: 4.6ms | Allocations: 1580)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.8ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.6ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-12 04:55:56.222668"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 4.3ms | Allocations: 1236)
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (2.0ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-12 04:55:56.246846"], ["updated_at", "2024-02-12 04:55:56.246846"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 2.9ms | Allocations: 789)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (1.0ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 6ms (Views: 0.2ms | ActiveRecord: 1.0ms | Allocations: 224)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.7ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 6ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 222)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 4ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 222)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 310)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 4ms (Views: 0.2ms | ActiveRecord: 0.6ms | Allocations: 322)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.3ms | ActiveRecord: 3.3ms | Allocations: 1297)
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:55:56 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (2.1ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 3.6ms | Allocations: 430)
  [1m[36mPromotion Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.8ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-12 04:57:49.267210', '2024-02-12 04:57:49.267210'), (754382202, 2, 'FOREVER', 15.0, '2024-02-12 04:57:49.267210', '2024-02-12 04:57:49.267210'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-12 04:57:49.267210', '2024-02-12 04:57:49.267210');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-12 04:57:49.269685', '2024-02-12 04:57:49.269685'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-12 04:57:49.269685', '2024-02-12 04:57:49.269685'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-12 04:57:49.269685', '2024-02-12 04:57:49.269685')[0m
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 5ms (Views: 0.2ms | ActiveRecord: 1.2ms | Allocations: 1299)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 218)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 216)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 6060)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 289)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 1234)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 1191)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f4271720500>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (2.0ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-12 04:57:49.470476"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 3.1ms | Allocations: 1155)
  [1m[36mItem Load (0.6ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (1.7ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-12 04:57:49.492999"], ["updated_at", "2024-02-12 04:57:49.492999"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 2.5ms | Allocations: 654)
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (2.0ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 3.2ms | Allocations: 479)
  [1m[36mItem Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.5ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 234)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 4ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 641)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 223)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 222)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 6366)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 322)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 2.4ms | Allocations: 1577)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 6ms (Views: 0.2ms | ActiveRecord: 2.0ms | Allocations: 1326)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.8ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.4ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-12 04:57:49.693895"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.2ms | ActiveRecord: 2.9ms | Allocations: 1224)
  [1m[36mPromotion Load (0.3ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (1.4ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-12 04:57:49.714848"], ["updated_at", "2024-02-12 04:57:49.714848"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.8ms | Allocations: 773)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (2.0ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 7ms (ActiveRecord: 3.2ms | Allocations: 430)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 04:57:49 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 274)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.0ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "items" DISABLE TRIGGER ALL;ALTER TABLE "promotions" DISABLE TRIGGER ALL;ALTER TABLE "schema_migrations" DISABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" DISABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (2.0ms)[0m  [1m[31mDELETE FROM "items";
DELETE FROM "promotions";
INSERT INTO "items" ("id", "code", "name", "price", "created_at", "updated_at") VALUES (1053882409, 1, 'MUG', 6.0, '2024-02-12 05:11:15.585553', '2024-02-12 05:11:15.585553'), (754382202, 2, 'FOREVER', 15.0, '2024-02-12 05:11:15.585553', '2024-02-12 05:11:15.585553'), (729484699, 3, 'Hoodie big', 20.0, '2024-02-12 05:11:15.585553', '2024-02-12 05:11:15.585553');
INSERT INTO "promotions" ("id", "title", "active", "discount", "open", "pattern", "free_stuff", "created_at", "updated_at") VALUES (983602829, '2-for-1', TRUE, DEFAULT, FALSE, '{mug}', '{mug}', '2024-02-12 05:11:15.587760', '2024-02-12 05:11:15.587760'), (851177574, 'Tshirt 30% for 3 and more', TRUE, 30, TRUE, '{tshirt,tshirt,tshirt}', DEFAULT, '2024-02-12 05:11:15.587760', '2024-02-12 05:11:15.587760'), (313349991, 'Buy 3 disctinct and get 3 other distinct for free', FALSE, DEFAULT, FALSE, '{tshirt,mug,hoodie}', '{tshirt,mug,hoodie}', '2024-02-12 05:11:15.587760', '2024-02-12 05:11:15.587760')[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "items" ENABLE TRIGGER ALL;ALTER TABLE "promotions" ENABLE TRIGGER ALL;ALTER TABLE "schema_migrations" ENABLE TRIGGER ALL;ALTER TABLE "ar_internal_metadata" ENABLE TRIGGER ALL[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
ItemsApiTest: test_Get_items_with_pagination_is_OK
--------------------------------------------------
Started GET "//items.json?per_page=1" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.2ms | ActiveRecord: 0.7ms | Allocations: 6713)
Started GET "//items.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 290)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_CREATE
-------------------------------------------------------
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "code"=>"tshirt"}}
Completed 422 Unprocessable Entity in 2ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 1720)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------
ItemsApiTest: test_GET_single_item_OK
-------------------------------------
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started GET "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.3ms | Allocations: 516)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------
ItemsApiTest: test_NOT_FOUND
----------------------------
Started GET "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 235)
Started PATCH "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"10"}, "id"=>"1007699722"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 216)
Started DELETE "//items/1007699722.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mItem Load (0.4ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 216)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_CREATE_item_OK
---------------------------------
  [1m[36mItem Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started POST "//items.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#create as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"black tshirt", "code"=>"tshirt"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Create (1.5ms)[0m  [1m[32mINSERT INTO "items" ("code", "name", "price", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["code", 2], ["name", "black tshirt"], ["price", 99.9], ["created_at", "2024-02-12 05:11:15.762383"], ["updated_at", "2024-02-12 05:11:15.762383"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 2.0ms | Allocations: 975)
  [1m[36mItem Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------
ItemsApiTest: test_UPDATE_item_OK
---------------------------------
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mItem Load (0.2ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
[31mUnpermitted parameters: :name, :code. Context: { controller: ItemsController, action: update, request: #<ActionDispatch::Request:0x00007f7e2aa517c0>, params: {"item"=>{"price"=>"99.9", "name"=>"MEDIUM TSHIRT :P", "code"=>"tshirt"}, "controller"=>"items", "action"=>"update", "id"=>"1053882409", "format"=>"json"} }[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Update (1.7ms)[0m  [1m[33mUPDATE "items" SET "price" = $1, "updated_at" = $2 WHERE "items"."id" = $3[0m  [["price", 99.9], ["updated_at", "2024-02-12 05:11:15.787402"], ["id", 1053882409]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 2.5ms | Allocations: 884)
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------
ItemsApiTest: test_DESTROY_goes_OK
----------------------------------
  [1m[36mItem Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
Started DELETE "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#destroy as JSON
  Parameters: {"id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mItem Destroy (1.6ms)[0m  [1m[31mDELETE FROM "items" WHERE "items"."id" = $1[0m  [["id", 1053882409]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 2.3ms | Allocations: 480)
  [1m[36mItem Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "items"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------
ItemsApiTest: test_UNPROCESSABLE_ENTITY_for_item_update
-------------------------------------------------------
Started PATCH "//items/1053882409.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by ItemsController#update as JSON
  Parameters: {"item"=>{"price"=>"-10"}, "id"=>"1053882409"}
  [1m[36mItem Load (0.3ms)[0m  [1m[34mSELECT "items".* FROM "items" WHERE "items"."id" = $1 LIMIT $2[0m  [["id", 1053882409], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 3ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 704)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------
ItemsApiTest: final_test
------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------
PromotionApiTest: test_Get_promotions_with_pagination_is_OK
-----------------------------------------------------------
Started GET "//promotions.json?per_page=1" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"per_page"=>"1"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1[0m  [["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 6576)
Started GET "//promotions.json?page=1&per_page=1" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#index as JSON
  Parameters: {"page"=>"1", "per_page"=>"1"}
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" LIMIT $1 OFFSET $2[0m  [["LIMIT", 1], ["OFFSET", 1]]
Completed 200 OK in 2ms (Views: 0.1ms | ActiveRecord: 0.4ms | Allocations: 323)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_CREATE
----------------------------------------------------------------
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Broken promo", "pattern"=>["mug", "mug"], "discount"=>"-10"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (1.9ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1[0m  [["active", true]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 7ms (Views: 0.2ms | ActiveRecord: 2.6ms | Allocations: 1587)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------
PromotionApiTest: test_GET_single_promotion_OK
----------------------------------------------
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started GET "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 464)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------
PromotionApiTest: test_NOT_FOUND
--------------------------------
Started GET "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#show as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.2ms | ActiveRecord: 0.5ms | Allocations: 225)
Started PATCH "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"active"=>"true"}, "id"=>"1007699722"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.5ms | Allocations: 222)
Started DELETE "//promotions/1007699722.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"1007699722"}
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 1007699722], ["LIMIT", 1]]
Filter chain halted as :render_not_found rendered or redirected
Completed 404 Not Found in 3ms (Views: 0.1ms | ActiveRecord: 0.6ms | Allocations: 222)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_CREATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started POST "//promotions.json" for 127.0.0.1 at 2024-02-12 05:11:15 +0000
Processing by PromotionsController#create as JSON
  Parameters: {"promotion"=>{"title"=>"Buy tshirt, get mug for free", "pattern"=>["tshirt"], "free_stuff"=>["mug"], "open"=>"false", "active"=>"false"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Create (2.1ms)[0m  [1m[32mINSERT INTO "promotions" ("title", "active", "pattern", "free_stuff", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["title", "Buy tshirt, get mug for free"], ["active", false], ["pattern", "{tshirt}"], ["free_stuff", "{mug}"], ["created_at", "2024-02-12 05:11:15.978552"], ["updated_at", "2024-02-12 05:11:15.978552"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 2.8ms | Allocations: 820)
  [1m[36mPromotion Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
PromotionApiTest: test_UPDATE_promotion_OK
------------------------------------------
  [1m[36mPromotion Load (0.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mPromotion Load (0.4ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 05:11:16 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"title"=>"new Promotion", "free_stuff"=>["tshirt"]}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.6ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mPromotion Update (0.6ms)[0m  [1m[33mUPDATE "promotions" SET "title" = $1, "free_stuff" = $2, "updated_at" = $3 WHERE "promotions"."id" = $4[0m  [["title", "new Promotion"], ["free_stuff", "{tshirt}"], ["updated_at", "2024-02-12 05:11:16.010332"], ["id", 983602829]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.5ms | ActiveRecord: 4.6ms | Allocations: 1207)
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------
PromotionApiTest: test_DESTROY_goes_OK
--------------------------------------
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
Started DELETE "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 05:11:16 +0000
Processing by PromotionsController#destroy as JSON
  Parameters: {"id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Destroy (2.0ms)[0m  [1m[31mDELETE FROM "promotions" WHERE "promotions"."id" = $1[0m  [["id", 983602829]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 6ms (ActiveRecord: 3.2ms | Allocations: 431)
  [1m[36mPromotion Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "promotions"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------
PromotionApiTest: test_UNPROCESSABLE_ENTITY_for_promotion_update
----------------------------------------------------------------
Started PATCH "//promotions/983602829.json" for 127.0.0.1 at 2024-02-12 05:11:16 +0000
Processing by PromotionsController#update as JSON
  Parameters: {"promotion"=>{"discount"=>"130"}, "id"=>"983602829"}
  [1m[36mPromotion Load (0.5ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE "promotions"."id" = $1 LIMIT $2[0m  [["id", 983602829], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mPromotion Load (2.8ms)[0m  [1m[34mSELECT "promotions".* FROM "promotions" WHERE (pattern && ARRAY['mug']::varchar[]) AND "promotions"."active" = $1 AND "promotions"."id" != $2[0m  [["active", true], ["id", 983602829]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 10ms (Views: 0.2ms | ActiveRecord: 4.3ms | Allocations: 1298)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------
PromotionApiTest: final_test
----------------------------
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------
MiniApivoreTestBase: final_test
-------------------------------
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
